---
title: "sample size determination"
output: 
  workflowr::wflow_html:
    code_folding: hide
    toc: true
date: "2025-08-01"
---


```{r, message=F, warning=F}
rm(list=ls())
library(ggplot2)
```




```{r, message=F, warning=F}

# Sample size function
sample_size_proportion <- function(p, margin_error, population, z_score = 1.96){
  q <- 1 - p
  z2 <- (z_score)^2
  d2 <- margin_error^2
  N <- (p * q * z2) / d2 
  n <- N / (1 + (N / population))
  
  return(min(N,n))
}

```





```{r, echo=F, message=F, warning=F, eval=F}
# Set up
p <- 1091 / 30498
population <- 30498
relative_errors <- seq(0.1, 1, by = 0.1)  # 10% to 100% of p
margin_errors <- p * relative_errors     # Convert to absolute margin of error


# Calculate sample sizes
sample_sizes <- sapply(margin_errors, function(d) {
  sample_size_proportion(p, margin_error = d, population = population)
})

# Make a data frame for plotting
df <- data.frame(
  Relative_Error = relative_errors,
  Sample_Size = round(sample_sizes)
)

# Draw bar plot with labels on top
ggplot(df, aes(x = factor(Relative_Error), y = Sample_Size)) +
  geom_bar(stat = "identity", fill = "steelblue") +
  geom_text(aes(label = Sample_Size), vjust = -0.5, size = 3) +
  labs(
    title = "Sample Size vs. Relative Margin of Error",
    x = "Margin of Error (as proportion of p)",
    y = "Sample Size"
  ) +
  theme_minimal() +
  theme(
    text = element_text(size = 14),
    plot.title = element_text(hjust = 0.5, face = "bold")
  )

```



```{r, message=F, warning=F, eval=T}
# Set up
#p <- 1091 / 30498
p=0.5
population <- 30498
#relative_errors <- seq(0.1, 1, by = 0.1)  # 10% to 100% of p
#margin_errors <- p * relative_errors     # Convert to absolute margin of error
margin_errors <- seq(0.01, 0.05, by=0.01)


# Calculate sample sizes
sample_sizes <- sapply(margin_errors, function(d) {
  sample_size_proportion(p, margin_error = d, population = population)
})

# Make a data frame for plotting
df <- data.frame(
  margin_errors = margin_errors,
  Sample_Size = round(sample_sizes)
)

df$cases=round(df$Sample_Size*1091/30498)



library(dplyr)
library(tidyr)
# Reshape to long format
df_long <- df %>%
  pivot_longer(cols = c(Sample_Size, cases),
               names_to = "Measure",
               values_to = "Count")

# Create side-by-side bar plot
ggplot(df_long, aes(x = factor(margin_errors), y = Count, fill = Measure)) +
  geom_bar(stat = "identity", position = position_dodge(width = 0.7)) +
  geom_text(aes(label = Count),
            position = position_dodge(width = 0.7),
            vjust = -0.5, size = 3.5) +
  labs(
    title = "Sample Size and Cases vs. Margin of Error",
    x = "Margin of Error",
    y = ""
  ) +
  theme_minimal() +
  theme(
    text = element_text(size = 14),
    plot.title = element_text(hjust = 0.5, face = "bold")
  ) +
  scale_fill_manual(values = c("steelblue", "darkorange"))
```

* cases=Sample_Size*1091/30498. 

 


## reference 

1. [Organizational Research: Determining
Appropriate Sample Size in Survey Research](https://www.opalco.com/wp-content/uploads/2014/10/Reading-Sample-Size1.pdf)
